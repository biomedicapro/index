<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Video con Subt√≠tulos</title>
    
    <!-- Importaci√≥n de la fuente 'Roboto Mono' desde Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ===========================
           Estilos CSS del Reproductor
           =========================== */
        
        /* Reset de estilos b√°sicos para eliminar m√°rgenes, paddings y establecer el box-sizing */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Estilos generales del cuerpo */
        body {
            font-family: 'Roboto Mono', monospace; /* Fuente monoespaciada */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh; /* Altura completa de la ventana */
            overflow: hidden; /* Oculta desbordes */
            background: #000; /* Fondo negro por defecto */
            color: white; /* Texto blanco por defecto */
            transition: background-color 0.5s, color 0.5s; /* Transiciones suaves para cambios de tema */
        }

        /* Estilos para el modo d√≠a */
        body.day-mode {
            background: #f0f0f0; /* Fondo claro */
            color: #000; /* Texto negro */
        }

        /* Contenedor principal de carga */
        #upload-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); /* Degradado oscuro */
            transition: background 0.5s;
            position: relative; /* Posicionamiento relativo para elementos hijos absolutos */
        }

        /* Estilos del contenedor de carga en modo d√≠a */
        body.day-mode #upload-container {
            background: linear-gradient(135deg, #ffffff 0%, #d3d3d3 100%); /* Degradado claro */
        }

        /* Contenedor interno de carga */
        #upload-inner {
            background: rgba(255,255,255,0.1); /* Fondo semi-transparente */
            padding: 40px;
            border-radius: 15px; /* Bordes redondeados */
            box-shadow: 0 0 20px rgba(0,0,0,0.5); /* Sombra para profundidad */
            text-align: center;
            max-width: 350px;
            width: 90%;
            transition: background 0.5s, color 0.5s;
            position: relative; /* Posicionamiento relativo para √≠conos internos */
        }

        /* Estilos del contenedor interno en modo d√≠a */
        body.day-mode #upload-inner {
            background: rgba(255,255,255,0.8); /* Fondo m√°s opaco */
            color: #000; /* Texto negro */
            box-shadow: 0 0 20px rgba(0,0,0,0.2); /* Sombra m√°s suave */
        }

        /* T√≠tulo dentro del contenedor de carga */
        #upload-inner h1 {
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* Espacio entre √≠conos y texto */
        }

        /* P√°rrafo descriptivo dentro del contenedor de carga */
        #upload-inner p {
            margin-bottom: 25px;
            font-size: 18px;
        }

        /* Grupo de entrada para archivos */
        #upload-inner .input-group {
            margin-bottom: 25px;
            text-align: left;
            font-size: 16px;
        }

        /* Etiquetas de los grupos de entrada */
        #upload-inner .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        /* Iconos dentro de las etiquetas */
        #upload-inner .input-group span {
            margin-right: 5px;
            font-size: 20px;
        }

        /* Estilos para los campos de entrada de tipo archivo */
        #upload-inner input[type="file"] {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            font-size: 14px;
            user-select: text; /* Permitir selecci√≥n de texto */
        }

        /* Bot√≥n de reproducci√≥n */
        #upload-inner button {
            width: 100%;
            background-color: #1a73e8; /* Azul */
            color: white;
            border: none;
            padding: 12px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        /* Efecto al pasar el cursor sobre el bot√≥n */
        #upload-inner button:hover {
            background-color: #1558b0; /* Azul m√°s oscuro */
            transform: scale(1.02); /* Peque√±o aumento de tama√±o */
        }

        /* √çcono del Manual */
        #manual-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
            color: #fff; /* Color blanco por defecto */
            z-index: 11; /* Asegura que est√© por encima de otros elementos */
        }

        /* √çcono del Manual en modo d√≠a */
        body.day-mode #manual-icon {
            color: #000; /* Color negro */
        }

        /* Efecto al pasar el cursor sobre el √≠cono del manual */
        #manual-icon:hover {
            color: #f1c40f; /* Amarillo brillante */
        }

        /* Contenedor de la flecha flotante interactiva */
        #floating-arrow-container {
            position: absolute;
            top: 60px; /* Posici√≥n ajustable */
            left: 10px; /* Posici√≥n ajustable */
            display: flex;
            align-items: center;
            cursor: pointer;
            animation: float 2s infinite; /* Animaci√≥n de flotaci√≥n */
            z-index: 10; /* Por debajo del √≠cono del manual */
            background: rgba(255, 255, 255, 0.2); /* Fondo semi-transparente */
            padding: 5px 10px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        /* Fondo del contenedor de la flecha en modo d√≠a */
        body.day-mode #floating-arrow-container {
            background: rgba(0, 0, 0, 0.2); /* Fondo oscuro semi-transparente */
        }

        /* Efecto al pasar el cursor sobre el contenedor de la flecha */
        #floating-arrow-container:hover {
            background: rgba(255, 255, 255, 0.4); /* Fondo m√°s claro */
        }

        body.day-mode #floating-arrow-container:hover {
            background: rgba(0, 0, 0, 0.4); /* Fondo m√°s oscuro en modo d√≠a */
        }

        /* √çcono de flecha con SVG */
        .arrow-icon {
            width: 40px;
            height: 40px;
            margin-left: 10px; /* Espacio entre el texto y la flecha */
            transition: transform 0.3s, fill 0.3s;
            fill: #fff; /* Color blanco por defecto */
        }

        /* √çcono de flecha en modo d√≠a */
        body.day-mode .arrow-icon {
            fill: #000; /* Color negro */
        }

        /* Efecto al pasar el cursor sobre el √≠cono de flecha */
        .arrow-icon:hover {
            transform: scale(1.1); /* Aumento de tama√±o */
            fill: #f1c40f; /* Cambio de color a amarillo */
        }

        /* Texto de la flecha */
        .arrow-text {
            font-size: 18px;
            font-weight: 700;
            color: #fff; /* Color blanco por defecto */
            transition: color 0.3s;
            white-space: nowrap; /* Evita que el texto se divida en varias l√≠neas */
        }

        /* Texto de la flecha en modo d√≠a */
        body.day-mode .arrow-text {
            color: #000; /* Color negro */
        }

        /* Animaci√≥n de flotaci√≥n para la flecha */
        @keyframes float {
            0% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-15px); /* Flotaci√≥n hacia arriba */
            }
            100% {
                transform: translateY(0);
            }
        }

/* Contenedor del video */
#video-container {
    width: 100%;
    height: 40%; /* Ocupa el 40% de la pantalla */
    background: #000; /* Fondo negro */
    display: none;
    justify-content: center;
    align-items: center;
}

/* Video */
#video-player {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Mantiene la relaci√≥n de aspecto */
    display: block;
}

/* Contenedor de subt√≠tulos */
#subtitle-container {
    width: 100%;
    height: 60%; /* Ocupa el 60% de la pantalla */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* Subt√≠tulos arriba */
    align-items: center;
    padding: 15px 25px;
    background: rgba(0, 0, 0, 0.8); /* Fondo semi-transparente negro */
    color: white; /* Texto blanco */
    text-align: center;
    overflow: hidden;
display: none;

}

/* Contenedor de subt√≠tulos en modo d√≠a */
body.day-mode #subtitle-container {
    background: rgba(255, 255, 255, 0.8); /* Fondo semi-transparente blanco */
    color: #000; /* Texto negro */
}

/* Estilos para el display de subt√≠tulos */
#subtitle-display {
    width: 100%;
    line-height: 1.5;
    word-wrap: break-word;
    max-width: 90%;
    user-select: text; /* Permitir selecci√≥n de texto */
    font-size: 1.2em;
}

/* Contenedor de subt√≠tulos en espa√±ol */
#subtitle-es-display {
    margin-top: 10px; /* Espacio entre los subt√≠tulos principales y los en espa√±ol */
    width: 100%;
    color: #CCCCCC; /* Color diferente para distinguir los subt√≠tulos en espa√±ol */
    word-wrap: break-word;
    font-size: 1em;
    text-align: left;
}

body.day-mode #subtitle-es-display {
    color: #333333; /* Color adaptado para modo d√≠a */
}
        /* Botones de cambio de tema y lista */
        #theme-toggle, #list-toggle {
            position: fixed;
            top: 20px;
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.7); /* Fondo semi-transparente negro */
            color: white;
            border: none;
            border-radius: 50%; /* Bot√≥n circular */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Sombra */
            transition: background-color 0.5s, color 0.5s;
        }

        /* Botones en modo d√≠a */
        #theme-toggle.day-mode, #list-toggle.day-mode {
            background: rgba(255, 255, 255, 0.7); /* Fondo semi-transparente blanco */
            color: #000; /* Texto negro */
        }

        /* Posici√≥n espec√≠fica de los botones */
        #theme-toggle {
            right: 80px; /* A la derecha con margen */
        }
        #list-toggle {
            right: 20px; /* M√°s cerca del borde derecho */
        }
#fullscreen-toggle {
    position: fixed;
    bottom: 20px;
    right: 80px; /* Ajusta la posici√≥n para que est√© al lado de los otros botones */
    width: 50px;
    height: 50px;
    background: rgba(0, 0, 0, 0.7); /* Fondo semi-transparente */
    color: white;
    border: none;
    border-radius: 50%; /* Bot√≥n circular */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Sombra */
    transition: background-color 0.3s, transform 0.2s;
}

#fullscreen-toggle:hover {
    background: rgba(0, 0, 0, 0.9); /* Fondo m√°s oscuro al pasar el cursor */
    transform: scale(1.1); /* Aumenta ligeramente el tama√±o */
}

        /* Estilo para palabras resaltadas */
        .highlighted {
            background-color: yellow; /* Fondo amarillo */
            color: black; /* Texto negro */
            cursor: pointer;
        }

        /* Resaltar la primera l√≠nea con un color diferente */
        .first-line {
            border-radius: 5px;
            padding: 2px 4px;
            transition: background-color 0.5s;
        }

        /* Resaltar la primera l√≠nea en modo d√≠a */
        body.day-mode .first-line {
            background-color: rgba(255, 255, 255, 0.5);
        }

        /* Contenedor para palabras seleccionadas */
        #selected-words-container {
            position: fixed;
            top: 20%;
            right: 20px;
            width: 220px;
            background: rgba(0,0,0,0.8); /* Fondo semi-transparente negro */
            color: white;
            padding: 10px;
            border-radius: 5px;
            display: none; /* Oculto por defecto */
            max-height: 50%;
            overflow-y: auto; /* Desplazamiento vertical si excede la altura */
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Sombra */
            transition: background 0.5s, color 0.5s;
        }

        /* Contenedor de palabras seleccionadas en modo d√≠a */
        body.day-mode #selected-words-container {
            background: rgba(255,255,255,0.8); /* Fondo semi-transparente blanco */
            color: black; /* Texto negro */
        }

        /* T√≠tulo del contenedor de palabras seleccionadas */
        #selected-words-container h2 {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
        }

        /* Lista de palabras seleccionadas */
        #selected-words-container ul {
            list-style: none; /* Sin vi√±etas */
            padding-left: 0;
            max-width: 100%;
            word-break: break-all; /* Romper palabras largas */
        }

        /* Elementos de la lista */
        #selected-words-container li {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Botones dentro de la lista de palabras seleccionadas */
        #selected-words-container li button {
            background-color: transparent;
            color: inherit; /* Hereda el color del texto */
            border: 2px solid currentColor; /* Borde con el color actual */
            border-radius: 50%; /* Bot√≥n circular */
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Efecto al pasar el cursor sobre los botones de la lista */
        #selected-words-container li button:hover {
            background-color: currentColor; /* Fondo cambia al color actual */
            color: #fff; /* Texto blanco */
        }

        /* Bot√≥n de descarga de la lista */
        #selected-words-container #download-button {
            margin-top: 10px;
            font-size: 14px;
            width: 100%;
            padding: 8px;
            background-color: #27ae60; /* Verde */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s, transform 0.2s;
        }

        /* Bot√≥n de descarga en modo d√≠a */
        body.day-mode #selected-words-container #download-button {
            background-color: #2ecc71; /* Verde m√°s claro */
        }

        /* Efecto al pasar el cursor sobre el bot√≥n de descarga */
        #selected-words-container #download-button:hover {
            background-color: #1e8449; /* Verde m√°s oscuro */
            transform: scale(1.05); /* Aumento de tama√±o */
        }

        /* Bot√≥n de limpiar toda la lista */
        #selected-words-container #clear-all {
            margin-top: 10px;
            font-size: 14px;
            width: 100%;
            padding: 8px;
            background-color: #e74c3c; /* Rojo */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        /* Bot√≥n de limpiar en modo d√≠a */
        body.day-mode #selected-words-container #clear-all {
            background-color: #c0392b; /* Rojo m√°s oscuro */
        }

        /* Efecto al pasar el cursor sobre el bot√≥n de limpiar */
        #selected-words-container #clear-all:hover {
            background-color: #a93226; /* Rojo a√∫n m√°s oscuro */
            transform: scale(1.05); /* Aumento de tama√±o */
        }

        /* Estilos para el Modal del Manual de Uso */
        #manual-modal {
            display: none; /* Oculto por defecto */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Fondo semi-transparente oscuro */
            z-index: 1000; /* Por encima de todos los elementos */
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Mostrar el modal cuando est√° activo */
        #manual-modal.active {
            display: flex;
        }

        /* Contenido del manual dentro del modal */
        #manual-content {
            background: #fff; /* Fondo blanco */
            color: #000; /* Texto negro */
            max-width: 600px;
            width: 100%;
            max-height: 80%;
            overflow-y: auto; /* Desplazamiento vertical si excede la altura */
            border-radius: 10px;
            padding: 20px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Sombra */
            transition: background 0.5s, color 0.5s;
        }

        /* Contenido del manual en modo d√≠a */
        body.day-mode #manual-content {
            background: #f9f9f9; /* Fondo muy claro */
            color: #000; /* Texto negro */
        }

        /* Bot√≥n de cerrar el modal */
        #manual-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #555; /* Color gris */
            transition: color 0.3s;
        }

        /* Efecto al pasar el cursor sobre el bot√≥n de cerrar */
        #manual-close:hover {
            color: #000; /* Cambio a negro */
        }

        /* T√≠tulos y texto dentro del manual */
        #manual-content h2 {
            margin-bottom: 15px;
            font-size: 24px;
            text-align: center;
        }

        #manual-content p, #manual-content ul {
            margin-bottom: 10px;
            line-height: 1.6;
            font-size: 16px;
        }

        /* Estilos para listas dentro del manual */
        #manual-content ul {
            padding-left: 20px;
        }

        /* Clase para ocultar elementos */
        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- ===========================
           Contenedor de Carga
           =========================== -->
    <div id="upload-container">
        <div id="upload-inner">
            <!-- √çcono del Manual -->
            <div id="manual-icon" title="Manual de Uso">‚ÑπÔ∏è</div>
            
            <!-- Flecha Flotante Interactiva Mejorada -->
            <div id="floating-arrow-container" title="Lea las instrucciones">
                <!-- Texto Descriptivo -->
                <div class="arrow-text">Lea las instrucciones</div>
                <!-- √çcono de Flecha SVG -->
                <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 2l8 8h-6v8h-4v-8H4z"/>
                </svg>
            </div>

            <!-- T√≠tulo Principal -->
            <h1>üé¨ Reproductor con Subt√≠tulos</h1>
            <!-- Descripci√≥n -->
            <p>Selecciona tu video y archivos de subt√≠tulos</p>
            
            <!-- Grupo de entrada para el video -->
            <div class="input-group">
                <label><span>üìπ</span>Video (mp4)</label>
                <input type="file" id="video-upload" accept="video/mp4">
            </div>
            
            <!-- Grupo de entrada para los subt√≠tulos originales -->
            <div class="input-group">
                <label><span>üìù</span>Subt√≠tulos (srt)</label>
                <input type="file" id="srt-upload" accept=".srt">
            </div>
            
            <!-- Grupo de entrada para subt√≠tulos en espa√±ol -->
            <div class="input-group">
                <label><span>üá™üá∏</span>Subt√≠tulos en Espa√±ol (srt)</label>
                <input type="file" id="srt-es-upload" accept=".srt">
            </div>
            
            <!-- Bot√≥n para iniciar la reproducci√≥n -->
            <button onclick="startPlayback()">‚ñ∂Ô∏è Reproducir</button>
        </div>
    </div>

    <!-- ===========================
           Contenedor del Video
           =========================== -->
<div id="video-container">
    <video id="video-player" controls></video>
</div>

<!-- Caja de subt√≠tulos -->
<div id="subtitle-container">
    <div id="subtitle-display"></div>
    <div id="subtitle-es-display"></div> <!-- Nuevo contenedor para subt√≠tulos en espa√±ol -->
</div>


    <!-- ===========================
           Botones de Modo y Lista
           =========================== -->
    <button id="theme-toggle" onclick="toggleTheme()">üåô</button>
    <button id="list-toggle">üìú</button>
<button id="fullscreen-toggle" aria-label="Pantalla completa">‚õ∂</button>
    <!-- ===========================
           Contenedor de Palabras Seleccionadas
           =========================== -->
    <div id="selected-words-container">
        <h2>Seleccionadas</h2>
        <ul id="selected-words-list"></ul>
        <button id="download-button">‚¨áÔ∏è Descargar lista</button>
        <button id="clear-all">üóëÔ∏è Limpiar todo</button>
    </div>

    <!-- ===========================
           Modal del Manual de Uso
           =========================== -->
    <div id="manual-modal">
        <div id="manual-content">
            <!-- Bot√≥n de Cerrar el Modal -->
            <button id="manual-close" title="Cerrar Manual">‚úñÔ∏è</button>
            <!-- Contenido del Manual -->
            <h2>Manual de Uso</h2>
            <p>Bienvenido al <strong>Reproductor de Video con Subt√≠tulos</strong>. A continuaci√≥n, se detallan las funcionalidades y c√≥mo utilizarlas de manera eficiente:</p>
            <h3>1. Carga de Archivos</h3>
            <ul>
                <li><strong>Video (mp4):</strong> Selecciona un archivo de video en formato MP4 desde tu dispositivo.</li>
                <li><strong>Subt√≠tulos (srt):</strong> Selecciona un archivo de subt√≠tulos en formato SRT que corresponda con el video seleccionado.</li>
                <li><strong>Subt√≠tulos en Espa√±ol (srt):</strong> Selecciona un archivo de subt√≠tulos en espa√±ol en formato SRT que tenga los mismos tiempos que los subt√≠tulos originales.</li>
            </ul>
            <h3>2. Reproducci√≥n</h3>
            <p>Una vez que hayas seleccionado todos los archivos necesarios, haz clic en el bot√≥n <strong>‚ñ∂Ô∏è Reproducir</strong> para iniciar la reproducci√≥n del video con los subt√≠tulos cargados.</p>
            <h3>3. Selecci√≥n de Palabras</h3>
            <ul>
                <li><strong>Selecci√≥n Individual:</strong> Haz clic en cualquier palabra de la primera l√≠nea de los subt√≠tulos (en el idioma original) para resaltar y agregarla a la lista de seleccionadas.</li>
                <li><strong>Selecci√≥n M√∫ltiple:</strong> Arrastra el cursor sobre varias palabras consecutivas de la primera l√≠nea para seleccionarlas como una sola entrada en la lista.</li>
            </ul>
            <h3>4. Gesti√≥n de Selecciones</h3>
            <ul>
                <li><strong>Descargar Lista:</strong> Haz clic en el bot√≥n <strong>‚¨áÔ∏è Descargar lista</strong> para descargar un archivo de texto con todas las palabras/frases seleccionadas.</li>
                <li><strong>Limpiar Todo:</strong> Haz clic en el bot√≥n <strong>üóëÔ∏è Limpiar todo</strong> para eliminar todas las selecciones de la lista.</li>
            </ul>
            <h3>5. Modo D√≠a/Noche</h3>
            <p>Usa el bot√≥n <strong>üåô/‚òÄÔ∏è</strong> ubicado en la parte superior derecha para alternar entre modo oscuro y claro, mejorando la visibilidad seg√∫n tus preferencias.</p>
            <h3>6. Reanudaci√≥n del Video</h3>
            <p>Al pausar el video, puedes reanudar la reproducci√≥n haciendo clic en cualquier √°rea de la pantalla que no sea interactiva (como los botones o la lista de seleccionadas).</p>
            <p>¬°Disfruta de una experiencia de visualizaci√≥n mejorada!</p>
        </div>
    </div>

    <!-- ===========================
           Scripts JavaScript
           =========================== -->
    <script>
        /* ===========================
           Variables y Elementos del DOM
           =========================== */
        
        // Arrays para almacenar los subt√≠tulos
        let subtitles = [];
        let spanishSubtitles = [];

        // Elementos del DOM para el video y subt√≠tulos
        const videoElement = document.getElementById('video-player');
        const subtitleDisplay = document.getElementById('subtitle-display');
        const spanishSubtitleDisplay = document.getElementById('subtitle-es-display'); // Nuevo elemento para subt√≠tulos en espa√±ol
        const videoContainer = document.getElementById('video-container');
        const subtitleContainer = document.getElementById('subtitle-container');
        const uploadContainer = document.getElementById('upload-container');
        const themeToggle = document.getElementById('theme-toggle');
        const listToggle = document.getElementById('list-toggle');
        const selectedWordsContainer = document.getElementById('selected-words-container');
        const selectedWordsList = document.getElementById('selected-words-list');
        const downloadButton = document.getElementById('download-button');
        const clearAllButton = document.getElementById('clear-all');

        // Elementos del Modal del Manual
        const manualIcon = document.getElementById('manual-icon');
        const manualModal = document.getElementById('manual-modal');
        const manualClose = document.getElementById('manual-close');
        const floatingArrowContainer = document.getElementById('floating-arrow-container');

        // Variables para controlar el estado
        let lastSubtitle = null; // √öltimo subt√≠tulo mostrado
        let isDayMode = false; // Estado del modo d√≠a/noche
        let selectedItems = []; // Lista de palabras/frases seleccionadas
        let videoFile = null; // Archivo de video seleccionado

        /* ===========================
           Carga de Datos desde localStorage
           =========================== */

        // Recuperar elementos seleccionados previamente almacenados en localStorage
        const storedItems = localStorage.getItem('selectedItems');
        if (storedItems) {
            selectedItems = JSON.parse(storedItems);
        }

        /* ===========================
           Manejo de la Carga de Archivos
           =========================== */

        // Evento para manejar la carga del archivo de video
        document.getElementById('video-upload').addEventListener('change', (event) => {
            videoFile = event.target.files[0]; // Guardar el archivo seleccionado
        });

        // Evento para manejar la carga del archivo de subt√≠tulos originales
        document.getElementById('srt-upload').addEventListener('change', (event) => {
            const srtFile = event.target.files[0];
            if (srtFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    parseSRT(e.target.result); // Parsear el contenido del archivo SRT
                };
                reader.readAsText(srtFile); // Leer el archivo como texto
            }
        });

        // Evento para manejar la carga del archivo de subt√≠tulos en espa√±ol
        document.getElementById('srt-es-upload').addEventListener('change', (event) => {
            const srtEsFile = event.target.files[0];
            if (srtEsFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    parseSRTSpanish(e.target.result); // Parsear el contenido del archivo SRT en espa√±ol
                };
                reader.readAsText(srtEsFile); // Leer el archivo como texto
            }
        });

        /* ===========================
           Funciones para Parsear Subt√≠tulos SRT
           =========================== */

        // Funci√≥n para parsear el archivo SRT y almacenar los subt√≠tulos
        function parseSRT(data) {
            const srtLines = data.split(/\r?\n/); // Dividir el contenido por l√≠neas
            subtitles = []; // Reiniciar el array de subt√≠tulos
            let i = 0;

            while (i < srtLines.length) {
                const line = srtLines[i].trim();

                // Verificar si la l√≠nea actual es un n√∫mero (identificador del subt√≠tulo)
                if (/^\d+$/.test(line)) {
                    const times = srtLines[i + 1].split(' --> '); // Obtener tiempos de inicio y fin
                    const start = parseTime(times[0]); // Convertir tiempo de inicio a segundos
                    const end = parseTime(times[1]); // Convertir tiempo de fin a segundos
                    let text = '';

                    i += 2; // Avanzar a la l√≠nea de texto del subt√≠tulo
                    while (i < srtLines.length && srtLines[i].trim() !== '') {
                        text += srtLines[i] + '\n'; // Concatenar l√≠neas de texto
                        i++;
                    }
                    text = text.trim(); // Eliminar espacios al inicio y fin
                    subtitles.push({ start, end, text }); // Agregar el subt√≠tulo al array
                } else {
                    i++; // Avanzar a la siguiente l√≠nea
                }
            }
        }

        // Funci√≥n para parsear el archivo SRT en espa√±ol y almacenar los subt√≠tulos
        function parseSRTSpanish(data) {
            const srtLines = data.split(/\r?\n/); // Dividir el contenido por l√≠neas
            spanishSubtitles = []; // Reiniciar el array de subt√≠tulos en espa√±ol
            let i = 0;

            while (i < srtLines.length) {
                const line = srtLines[i].trim();

                // Verificar si la l√≠nea actual es un n√∫mero (identificador del subt√≠tulo)
                if (/^\d+$/.test(line)) {
                    const times = srtLines[i + 1].split(' --> '); // Obtener tiempos de inicio y fin
                    const start = parseTime(times[0]); // Convertir tiempo de inicio a segundos
                    const end = parseTime(times[1]); // Convertir tiempo de fin a segundos
                    let text = '';

                    i += 2; // Avanzar a la l√≠nea de texto del subt√≠tulo
                    while (i < srtLines.length && srtLines[i].trim() !== '') {
                        text += srtLines[i] + '\n'; // Concatenar l√≠neas de texto
                        i++;
                    }
                    text = text.trim(); // Eliminar espacios al inicio y fin
                    spanishSubtitles.push({ start, end, text }); // Agregar el subt√≠tulo al array
                } else {
                    i++; // Avanzar a la siguiente l√≠nea
                }
            }
        }

        // Funci√≥n para convertir un tiempo en formato SRT a segundos
        function parseTime(timeString) {
            const parts = timeString.split(/[:,]/); // Separar horas, minutos, segundos y milisegundos
            return (
                parseInt(parts[0]) * 3600 + // Horas a segundos
                parseInt(parts[1]) * 60 +   // Minutos a segundos
                parseInt(parts[2]) +        // Segundos
                parseInt(parts[3]) / 1000   // Milisegundos a segundos
            );
        }

        /* ===========================
           Funci√≥n para Iniciar la Reproducci√≥n
           =========================== */

        function startPlayback() {
            // Verificar si se ha cargado un video
            if (!videoFile) {
                alert('Por favor, sube un video primero.');
                return;
            }

            // Verificar si se han cargado subt√≠tulos originales
            if (subtitles.length === 0) {
                alert('Por favor, sube un archivo de subt√≠tulos original (.srt).');
                return;
            }

            // Verificar si se han cargado subt√≠tulos en espa√±ol
            if (spanishSubtitles.length === 0) {
                alert('Por favor, sube un archivo de subt√≠tulos en espa√±ol (.srt).');
                return;
            }

            // Asignar la fuente del video utilizando la URL creada a partir del archivo seleccionado
            videoElement.src = URL.createObjectURL(videoFile);
            uploadContainer.style.display = 'none'; // Ocultar el contenedor de carga
            videoContainer.style.display = 'flex'; // Mostrar el contenedor de video
            subtitleContainer.style.display = 'flex'; // Mostrar el contenedor de subt√≠tulos
            floatingArrowContainer.style.display = 'none'; // Ocultar la flecha una vez iniciado el video

            // Entrar en modo pantalla completa
            enterFullScreen(document.documentElement);
            videoElement.play(); // Iniciar reproducci√≥n del video

            // Evento para actualizar los subt√≠tulos en funci√≥n del tiempo de reproducci√≥n
            videoElement.ontimeupdate = () => {
                const currentTime = videoElement.currentTime;
                const subtitle = subtitles.find(
                    (sub) => currentTime >= sub.start && currentTime <= sub.end
                );
                const spanishSubtitle = spanishSubtitles.find(
                    (sub) => currentTime >= sub.start && currentTime <= sub.end
                );

                if (subtitle && subtitle !== lastSubtitle) {
                    lastSubtitle = subtitle; // Actualizar el √∫ltimo subt√≠tulo mostrado
                    videoElement.pause(); // Pausar el video para mostrar el subt√≠tulo

                    const lines = calculateEffectiveLines(subtitle.text); // Calcular l√≠neas efectivas
                    adjustSubtitleSize(lines); // Ajustar el tama√±o de la fuente seg√∫n las l√≠neas
                    const formattedSubtitle = formatSubtitle(subtitle.text); // Formatear el subt√≠tulo
                    subtitleDisplay.innerHTML = formattedSubtitle; // Mostrar el subt√≠tulo

                    addSelectionEvents(); // A√±adir eventos de selecci√≥n a las palabras

                    subtitleDisplay.style.opacity = '1'; // Hacer visible el subt√≠tulo
                } else if (!subtitle) {
                    subtitleDisplay.style.opacity = '0'; // Ocultar el subt√≠tulo si no hay ninguno
                }

                // Manejar los subt√≠tulos en espa√±ol
                if (spanishSubtitle) {
                    const formattedSpanishSubtitle = formatSpanishSubtitle(spanishSubtitle.text);
                    spanishSubtitleDisplay.innerHTML = formattedSpanishSubtitle; // Aplicar formateo
                    spanishSubtitleDisplay.style.opacity = '1'; // Hacer visible el subt√≠tulo en espa√±ol
                } else {
                    spanishSubtitleDisplay.style.opacity = '0'; // Ocultar el subt√≠tulo en espa√±ol si no hay ninguno
                }
            };
        }

        /* ===========================
           Funciones para Manejar Subt√≠tulos
           =========================== */

        // Calcular el n√∫mero efectivo de l√≠neas para ajustar el tama√±o de la fuente
        function calculateEffectiveLines(text) {
            const words = text.split(' ');
            let effectiveLines = 0;

            words.forEach((word) => {
                effectiveLines += Math.ceil(word.length / 40); // Estimaci√≥n de l√≠neas por palabra
            });

            return effectiveLines;
        }

        // Ajustar el tama√±o de la fuente seg√∫n el n√∫mero de l√≠neas
        function adjustSubtitleSize(lineCount) {
            if (lineCount <= 2) {
                spanishSubtitleDisplay.style.fontSize = '38px';
            } else if (lineCount <= 6) {
                spanishSubtitleDisplay.style.fontSize = '24px';
            } else if (lineCount <= 10) {
                spanishSubtitleDisplay.style.fontSize = '30px';
            } else if (lineCount <= 14) {
                spanishSubtitleDisplay.style.fontSize = '26px';
            } else {
                spanishSubtitleDisplay.style.fontSize = '20px';
            }
        }

        // Formatear los subt√≠tulos originales, envolviendo cada palabra en un <span> para permitir la selecci√≥n
        function formatSubtitle(text) {
            const lines = text.split('\n');
            if (lines.length === 0) return '';
            const firstLine = lines[0];
            const otherLines = lines.slice(1).join('<br>');

            // Envolver cada palabra de la primera l√≠nea en un span para permitir la selecci√≥n
            const formattedFirstLine = firstLine.split(' ').map(word => {
                return `<span class="word">${word}</span>`;
            }).join(' ');

            // Devolver el subt√≠tulo formateado con la primera l√≠nea resaltada
            return `<div class="first-line">${formattedFirstLine}</div><br>${otherLines}`;
        }

        // Nueva funci√≥n para formatear los subt√≠tulos en espa√±ol (sin envoltura en spans)
        function formatSpanishSubtitle(text) {
            // Puedes aplicar cualquier formateo adicional aqu√≠ si es necesario
            // Por ejemplo, puedes agregar cursivas, negritas, etc.
            // En este caso, simplemente devolvemos el texto tal cual
            return text.replace(/\n/g, '<br>'); // Reemplazar saltos de l√≠nea por <br>
        }

        /* ===========================
           Funci√≥n para Entrar en Pantalla Completa
           =========================== */

        function enterFullScreen(element) {
            if (element.requestFullscreen) {
                element.requestFullscreen();
            } else if (element.mozRequestFullScreen) { /* Firefox */
                element.mozRequestFullScreen();
            } else if (element.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                element.webkitRequestFullscreen();
            } else if (element.msRequestFullscreen) { /* IE/Edge */
                element.msRequestFullscreen();
            }
        }

        /* ===========================
           Funci√≥n para Alternar Modo D√≠a/Noche
           =========================== */

        function toggleTheme() {
            isDayMode = !isDayMode; // Cambiar el estado del modo
            document.body.classList.toggle('day-mode', isDayMode); // Alternar clase en el cuerpo
            uploadContainer.classList.toggle('day-mode', isDayMode); // Alternar clase en el contenedor de carga
            videoContainer.classList.toggle('day-mode', isDayMode); // Alternar clase en el contenedor de video
            subtitleContainer.classList.toggle('day-mode', isDayMode); // Alternar clase en el contenedor de subt√≠tulos
            selectedWordsContainer.classList.toggle('day-mode', isDayMode); // Alternar clase en el contenedor de palabras seleccionadas
            themeToggle.classList.toggle('day-mode', isDayMode); // Alternar clase en el bot√≥n de tema
            listToggle.classList.toggle('day-mode', isDayMode); // Alternar clase en el bot√≥n de lista
            manualContentStyle(); // Ajustar estilos del contenido del manual

            // Cambiar el √≠cono del bot√≥n seg√∫n el modo
            themeToggle.innerHTML = isDayMode ? 'üåô' : '‚òÄÔ∏è';
        }

        // Ajustar estilos del contenido del manual seg√∫n el modo
        function manualContentStyle() {
            const manualContent = document.getElementById('manual-content');
            if (isDayMode) {
                manualContent.style.background = '#f9f9f9';
                manualContent.style.color = '#000';
            } else {
                manualContent.style.background = '#fff';
                manualContent.style.color = '#000';
            }
        }

        /* ===========================
           Funciones para Manejar la Selecci√≥n de Palabras
           =========================== */

        // A√±adir eventos de selecci√≥n y clic a las palabras de la primera l√≠nea
        function addSelectionEvents() {
            // A√±adir evento de clic a cada palabra individual de la primera l√≠nea
            subtitleDisplay.querySelectorAll('.word').forEach(wordEl => {
                wordEl.addEventListener('click', (e) => {
                    const text = wordEl.textContent.trim(); // Obtener el texto de la palabra
                    if (text && !selectedItems.includes(text)) {
                        selectedItems.push(text); // Agregar a la lista de seleccionados
                        updateLocalStorage(); // Actualizar localStorage
                        wordEl.classList.add('highlighted'); // Resaltar visualmente la palabra
                        updateSelectedWordsList(); // Actualizar la lista visual
                    }
                    e.stopPropagation(); // Evitar que el clic propague al body
                });
            });

            // A√±adir evento de selecci√≥n de texto (frase) en la primera l√≠nea
            subtitleDisplay.addEventListener('pointerup', (e) => {
                const selection = window.getSelection();
                const selectedText = selection.toString().trim(); // Obtener el texto seleccionado

                if (selectedText && !selectedItems.includes(selectedText)) {
                    // Verificar si la selecci√≥n est√° completamente dentro de la primera l√≠nea
                    if (selection.rangeCount > 0) {
                        const range = selection.getRangeAt(0);
                        const startContainer = range.startContainer;
                        const endContainer = range.endContainer;

                        // Verificar si ambos extremos de la selecci√≥n est√°n dentro de '.first-line'
                        const startWithinFirstLine = startContainer.parentElement.closest('.first-line');
                        const endWithinFirstLine = endContainer.parentElement.closest('.first-line');

                        if (startWithinFirstLine && endWithinFirstLine) {
                            // Resaltar la selecci√≥n
                            const highlightSpan = document.createElement('span');
                            highlightSpan.classList.add('highlighted');

                            try {
                                range.surroundContents(highlightSpan); // Envolver la selecci√≥n en un span
                            } catch (error) {
                                // Si la selecci√≥n es compleja (cruza nodos), simplemente agregar el texto sin resaltar
                            }

                            selectedItems.push(selectedText); // Agregar a la lista de seleccionados
                            updateLocalStorage(); // Actualizar localStorage
                            updateSelectedWordsList(); // Actualizar la lista visual
                        }
                    }
                }

                // Limpiar la selecci√≥n visual
                selection.removeAllRanges();
                e.stopPropagation(); // Evitar que el clic propague al body
            });
        }

        // Funci√≥n para actualizar el localStorage con los elementos seleccionados
        function updateLocalStorage() {
            localStorage.setItem('selectedItems', JSON.stringify(selectedItems));
        }

        // Funci√≥n para actualizar la lista visual de palabras seleccionadas
        function updateSelectedWordsList() {
            selectedWordsList.innerHTML = ''; // Limpiar la lista existente
            selectedItems.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item; // Agregar el texto de la palabra/frase

                // Bot√≥n para eliminar la palabra/frase de la lista
                const removeBtn = document.createElement('button');
                removeBtn.textContent = '‚úñÔ∏è';
                removeBtn.title = 'Eliminar';
                removeBtn.addEventListener('click', () => {
                    removeSelectedItem(item); // Eliminar el elemento al hacer clic
                });

                li.appendChild(removeBtn); // A√±adir el bot√≥n al elemento de la lista
                selectedWordsList.appendChild(li); // A√±adir el elemento a la lista
            });
        }

        // Funci√≥n para eliminar una palabra/frase de la lista de seleccionados
        function removeSelectedItem(item) {
            selectedItems = selectedItems.filter(i => i !== item); // Filtrar el elemento
            updateLocalStorage(); // Actualizar localStorage
            updateSelectedWordsList(); // Actualizar la lista visual

            // Eliminar la clase 'highlighted' de las palabras/frases eliminadas en el subt√≠tulo
            const highlightedSpans = subtitleDisplay.querySelectorAll('.highlighted');
            highlightedSpans.forEach(span => {
                if (span.textContent.trim() === item) {
                    span.classList.remove('highlighted'); // Remover la clase
                    // Reemplazar el span por su contenido de texto
                    const parent = span.parentNode;
                    parent.replaceChild(document.createTextNode(span.textContent), span);
                }
            });
        }

        // Funci√≥n para limpiar toda la lista de seleccionados
        function clearAllSelectedItems() {
            selectedItems = []; // Reiniciar la lista
            updateLocalStorage(); // Actualizar localStorage
            updateSelectedWordsList(); // Actualizar la lista visual

            // Eliminar todas las clases 'highlighted'
            const highlightedSpans = subtitleDisplay.querySelectorAll('.highlighted');
            highlightedSpans.forEach(span => {
                span.classList.remove('highlighted'); // Remover la clase
                // Reemplazar el span por su contenido de texto
                const parent = span.parentNode;
                parent.replaceChild(document.createTextNode(span.textContent), span);
            });
        }
const fullscreenToggle = document.getElementById('fullscreen-toggle');

// Alternar pantalla completa
fullscreenToggle.addEventListener('click', () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen() // Todo el documento en pantalla completa
            .catch(err => console.error(`Error al entrar en pantalla completa: ${err}`));
    } else {
        document.exitFullscreen() // Salir de pantalla completa
            .catch(err => console.error(`Error al salir de pantalla completa: ${err}`));
    }
});

        /* ===========================
           Eventos para Botones de la Lista de Seleccionados
           =========================== */

        // Evento para el bot√≥n de descargar la lista
        downloadButton.addEventListener('click', () => {
            const text = selectedItems.join('\n'); // Unir las palabras/frases con saltos de l√≠nea
            const blob = new Blob([text], { type: 'text/plain' }); // Crear un blob de texto
            const url = URL.createObjectURL(blob); // Crear una URL para el blob

            const a = document.createElement('a'); // Crear un enlace temporal
            a.href = url;
            a.download = 'lista_seleccionada.txt'; // Nombre del archivo de descarga
            a.click(); // Simular un clic para iniciar la descarga

            URL.revokeObjectURL(url); // Revocar la URL creada
        });

        // Evento para el bot√≥n de limpiar toda la lista
        clearAllButton.addEventListener('click', () => {
            if (confirm('¬øEst√°s seguro de que deseas limpiar toda la lista?')) {
                clearAllSelectedItems(); // Limpiar la lista si el usuario confirma
            }
        });

        // Evento para mostrar u ocultar el contenedor de palabras seleccionadas
        listToggle.addEventListener('click', () => {
            if (selectedWordsContainer.style.display === 'none' || selectedWordsContainer.style.display === '') {
                selectedWordsContainer.style.display = 'block'; // Mostrar la lista
                updateSelectedWordsList(); // Actualizar la lista visual
            } else {
                selectedWordsContainer.style.display = 'none'; // Ocultar la lista
            }
        });

        /* ===========================
           Funcionalidad del Modal del Manual de Uso
           =========================== */

        // Abrir el manual al hacer clic en el √≠cono
        manualIcon.addEventListener('click', () => {
            manualModal.classList.add('active'); // Mostrar el modal
        });

        // Cerrar el manual al hacer clic en el bot√≥n de cerrar
        manualClose.addEventListener('click', () => {
            manualModal.classList.remove('active'); // Ocultar el modal
        });

        // Cerrar el manual al hacer clic fuera del contenido del manual
        manualModal.addEventListener('click', (e) => {
            if (e.target === manualModal) {
                manualModal.classList.remove('active'); // Ocultar el modal
            }
        });

        /* ===========================
           Funcionalidad de la Flecha Flotante Mejorada
           =========================== */

        // Abrir el manual al hacer clic en la flecha
        floatingArrowContainer.addEventListener('click', () => {
            manualModal.classList.add('active'); // Mostrar el modal
            floatingArrowContainer.style.display = 'none'; // Opcional: ocultar la flecha despu√©s de interactuar
        });

        /* ===========================
           Reanudaci√≥n del Video al Hacer Clic en el Body
           =========================== */

        // Evento para reanudar el video al hacer clic en cualquier parte del body, excepto en √°reas interactivas
        document.body.addEventListener('click', (e) => {
            // Verificar si el clic est√° dentro de los subt√≠tulos, la lista, los botones, el manual o la flecha
            const isClickInsideSubtitle = subtitleContainer.contains(e.target);
            const isClickInsideList = selectedWordsContainer.contains(e.target);
            const isClickOnButtons = themeToggle.contains(e.target) || listToggle.contains(e.target);
            const isClickOnManual = manualModal.contains(e.target) || manualIcon.contains(e.target);
            const isClickOnArrow = floatingArrowContainer.contains(e.target);

            // Si el clic no est√° en ninguna de las √°reas interactivas, reanudar el video si est√° pausado
            if (!isClickInsideSubtitle && !isClickInsideList && !isClickOnButtons && !isClickOnManual && !isClickOnArrow) {
                if (videoElement.paused && videoElement.currentTime > 0 && !videoElement.ended) {
                    videoElement.play();
                }
            } else if (isClickInsideSubtitle) {
                // Si el clic est√° dentro de los subt√≠tulos, pero no en la primera l√≠nea
                const isClickOnWord = e.target.classList.contains('word') || e.target.classList.contains('highlighted');
                const isClickOnFirstLine = e.target.closest('.first-line');
                if (isClickOnFirstLine && !isClickOnWord) {
                    // Hacer clic en la primera l√≠nea pero no en una palabra permite reanudar
                    if (videoElement.paused && videoElement.currentTime > 0 && !videoElement.ended) {
                        videoElement.play();
                    }
                } else if (!isClickOnFirstLine) {
                    // Hacer clic fuera de la primera l√≠nea permite reanudar
                    if (videoElement.paused && videoElement.currentTime > 0 && !videoElement.ended) {
                        videoElement.play();
                    }
                }
            }
        });

        /* ===========================
           Evitar que Clics en √Åreas Interactivas Reanuden el Video
           =========================== */

        // Evitar que los clics dentro de la lista reanuden el video
        selectedWordsContainer.addEventListener('click', (e) => {
            e.stopPropagation(); // Evitar la propagaci√≥n del evento
        });

        // Evitar que los clics en botones reanuden el video
        themeToggle.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        listToggle.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // Evitar que los clics en el manual y la flecha reanuden el video
        manualModal.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        manualIcon.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        floatingArrowContainer.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        /* ===========================
           Inicializaci√≥n al Cargar la P√°gina
           =========================== */

        // Al cargar la p√°gina, actualizar la lista si ya hay elementos guardados
        updateSelectedWordsList();
    </script>
</body>
</html>
